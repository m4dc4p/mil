\usepackage[T1]{fontenc}
\usepackage{calc}
%% \usepackage{fourier}
\usepackage{palatino}
\renewcommand\ttdefault{lmtt}
\usepackage{helvet}
%% \usepackage{inconsolata}
\usepackage{comment}
\usepackage{calc}
\usepackage{xspace}
\usepackage{verbatim}
\usepackage{url}
\usepackage{fancyvrb}
\usepackage{setspace}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage[margin=\parindent, format=hang,labelfont=bf]{caption}
%% \usepackage[subrefformat=parens]{subcaption}
%% The following makes sure we get parentheses around
%% subreferences. The newest version of the subcaption
%% package has an option for this, but that's not available
%% widely.
%%
%% From http://tex.stackexchange.com/questions/25644
\usepackage[labelformat=simple]{subcaption}
\makeatletter
  \def\thesubfigure{(\alph{subfigure})}
  \providecommand\thefigsubsep{~}
  \def\p@subfigure{\@nameuse{thefigure}\thefigsubsep}
\makeatother

\usepackage{ifthen}
\usepackage{stmaryrd}
\usepackage{longtable}
\usepackage{afterpage}
\usepackage{xifthen}
\usepackage{mathtools}
\usepackage{xparse}
\usepackage[natbib=true,style=authoryear,backend=bibtex8]{biblatex}
\setlength{\bibitemsep}{\bigskipamount}
\addbibresource{thesis.bib}
\usepackage{microtype}

\usepackage{tikz}
\usetikzlibrary{arrows,automata,positioning,calc}
%% Used for CFGs.
\tikzset{
  >=stealth, 
  node distance=.5in,
  stmt/.style={rectangle,
    draw=black, thick,        
    minimum height=2em,
    %% inner sep=2pt,
    %% text centered,
    %% node distance=.5in,
  },
  entex/.style={
    minimum height=2em,
    %% inner sep=2pt,
    %% text centered,
  },
  labelfor/.style={circle, 
    draw=black, thin,
    font={\footnotesize},
    inner sep=0,
    fill=white,
    above right=-1.5mm and -1.5mm of #1,
  },
  fact/.style={overlay},
  %% Invisible node
  invis/.style={inner sep=0pt, 
    minimum height=0em}, 
  table/.style={circle, fill=white,height=2mm}
}

%% GSO margins.
\usepackage[left=1.5in, right=1in, top=1in, bottom=1in]{geometry}
\usepackage{abstract}

%% GSO requires 12 pt font for all headings
\usepackage[bf,sf,tiny,compact]{titlesec}
\titleformat{\chapter}[display]
            {}% format
            {\sffamily\bfseries\chaptertitlename\ \thechapter}
            {\baselineskip}
            {\sffamily\bfseries}
            {}

\hyphenation{data-flow mo-na-dic} 

\newboolean{lhs2tex}
\setboolean{lhs2tex}{true}

% Used by included files to know they
% are NOT standalone
\newboolean{standaloneFlag}
\setboolean{standaloneFlag}{true}

\newlength{\rulefigmargin}
\setlength{\rulefigmargin}{2\parindent}

\newcommand\figbegin{\rule{\linewidth-\rulefigmargin}{0.4pt}\\\vspace{12pt}}
\newcommand\figend{\rule{\linewidth-\rulefigmargin}{0.4pt}}

%\providecommand{\citep}[1]{(\emph{#1})\xspace}
%\renewcommand{\cite}[1]{\emph{#1}\xspace}

%% Functional languages chapter commands
\newcommand{\lamA}{\ensuremath{\lambda}-calculus\xspace}
\newcommand{\LamA}{\ensuremath{\lambda}-Calculus\xspace}
\newcommand{\lamAbs}[2]{\ensuremath{\lambda#1.\ #2}}
\newcommand{\lamApp}[2]{\ensuremath{#1\ #2}}
\newcommand{\lamPApp}[2]{\ensuremath{(#1\ #2)}}
\newcommand{\lamAPp}[2]{\ensuremath{(#1)\ #2}}
\newcommand{\lamApP}[2]{\ensuremath{#1\ (#2)}}
\newcommand{\lamAPP}[2]{\ensuremath{(#1)\ (#2)}}
\let\lamApPp=\lamApP
\let\lamAppP=\lamAPp

\newcommand{\lamId}{\lamAbs{x}{x}}
\newcommand{\lamCompose}{\lamAbs{f}{\lamAbs{g}{\lamAbs{x}{\lamApp{f}{(\lamApp{g}{x})}}}}}
\newcommand{\machLam}{\ensuremath{M_\lambda}\xspace}
\newcommand{\compMach}[1]{\ensuremath{\left\llbracket #1 \right\rrbracket}}
\newcommand{\compRho}[1]{\ensuremath{\rho(#1)}}
\newcommand{\verSub}[2]{\ensuremath{#1_{#2}}}
\newcommand{\verSup}[2]{\ensuremath{#1^{#2}}}
\newcommand{\lamC}{\ensuremath{\lambda_C}\xspace}
\newcommand{\lamPlus}{\lamAbs{m}{\lamAbs{n}{\lamAbs{s}{\lamAbs{z}{\lamApp{m}{\lamApPp{s}{\lamApp{n}{\lamApp{s}{z}}}}}}}}}
%% Substitution notation -- [#1 -> #2]
\newcommand{\lamSubst}[2]{\ensuremath{[#1 \mapsto #2]}}
%% End functional languages chapter

%% Dataflow chapter commands
\newcounter{nodeCounter}[figure]
\newcommand{\inE}{\ensuremath{\mathit{in}}\xspace}
\newcommand{\out}{\ensuremath{\mathit{out}}\xspace}
\newcommand{\In}{\ensuremath{\mathit{In}}\xspace}
\newcommand{\InBa}{\ensuremath{\mathit{In}(B)}\xspace}
\newcommand{\Out}{\ensuremath{\mathit{Out}}\xspace}
%% Out(B_x) -- fact function for an named block.
\newcommand{\OutB}[1]{\ensuremath{\mathit{Out}(B_{\ref{#1}})}\xspace}
\newcommand{\OutBa}{\ensuremath{\mathit{Out}(B)}\xspace}
%% in(B) -- fact function for an anonymous block.
\newcommand{\inBa}{\ensuremath{\mathit{in}(B)}\xspace}
%% in(X) -- fact function for an anonymous block, but using a different variable.
\newcommand{\inXa}[1]{\ensuremath{\mathit{in}(#1)}\xspace}
%% in(B,v) -- fact function for an anonymous block and some variable.
\newcommand{\inBav}[1]{\ensuremath{\mathit{in}(B, #1)}\xspace}
%% in(B_x) -- fact function for an named block.
\newcommand{\inB}[1]{\ensuremath{\mathit{in}(B_{\ref{#1}})}\xspace}
%% in(B_x,v) -- fact function for an named block and some variable.
\newcommand{\inBv}[2]{\ensuremath{\mathit{in}(B_{\ref{#1}}, #2)}\xspace}
%% out(B) -- fact function for an anonymous block.
\newcommand{\outBa}{\ensuremath{\mathit{out}(B)}\xspace}
%% out(X) -- fact function for an anonymous block, but using a different variable.
\newcommand{\outXa}[1]{\ensuremath{\mathit{out}(#1)}\xspace}
%% out(B,v) -- fact function for an anonymous block and some variable.
\newcommand{\outBav}[1]{\ensuremath{\mathit{out}(B, #1)}\xspace}
%% out(B_x) -- fact function for an named block.
\newcommand{\outB}[1]{\ensuremath{\mathit{out}(B_{\ref{#1}})}\xspace}
%% out(B_x,v) -- fact function for an named block and some variable.
\newcommand{\outBv}[2]{\ensuremath{\mathit{out}(B_{\ref{#1}}, #2)}\xspace}
\newcommand{\entryN}{\emph{E}\xspace}
\newcommand{\exitN}{\emph{X}\xspace}
\newcommand{\refNode}[1]{\ensuremath{B_{\ref{#1}}}\xspace}
\newcommand{\labelNode}[1]{\refstepcounter{nodeCounter}\label{#1}}
\newcommand{\setL}[1]{\textsc{#1}\xspace}
\newcommand{\setLC}{\setL{Const}}

%% Formats a list of facts
%% Argument should be like \facts{a/1, b/2, foobar/\bot, baz/\top}.
%% 
\newcounter{factctr}
\newtoks\varVal
\newtoks\varName
\newcommand{\facts}[1]{\begingroup%%
  %% Test if the argument given contains a forward slash (/). Expands
  %% slashTest with argument such that if a slash is NOT present the 
  %% token \noSlash will be given as argument 2 to slashTest. Otherwise
  %% there must be slash.
  \def\hasSlash##1{\expandafter\slashTest##1/\noslash\endslash}%%
  \def\slashTest##1/##2##3\endslash{\ifx\noslash##2 N\else Y\fi}%%
  \def\getArgs##1/##2{\varName={##1}%%
    \varVal={##2}}
  \ensuremath{%%
    \setcounter{factctr}{0}%%
    \foreach \var in {#1}{%%
      %% Separate list with a comma
      \ifthenelse{\value{factctr}>0}{,\allowbreak}{}%%
      %% \tracingmacros=1%%
      %% If key/val arguments, use first form. Otherwise
      %% use second.
      \ifthenelse{\equal{\hasSlash{\var}}{Y}}%%
                  {\expandafter\getArgs\var \factC{\the\varName}{\the\varVal}}%%
                  {\var}%%
      %% \tracingmacros=0%%
      \stepcounter{factctr}%%
    }}%%
\endgroup}
\newcommand{\factC}[2]{{\ensuremath{(\mathit{#1},#2)}}}
\newcommand{\doFacts}[4]{\ensuremath{#3{#1}: %%
    \left\{ %%
    \begin{minipage}[c]{#4}%%
      \facts{#2} %%
  \end{minipage}\kern -0.23em\right\}}}

\ExplSyntaxOn
\DeclareDocumentCommand \inFactsM {m m m} {\doFacts{#1}{#2}{\inB}{#3}}
\DeclareDocumentCommand \inFacts {m m O{1in}} {\doFacts{#1}{#2}{\inB}{#3}}
\DeclareDocumentCommand \outFactsM {m m m} {\doFacts{#1}{#2}{\outB}{#3}}
\DeclareDocumentCommand \outFacts {m m O{1in}} {\doFacts{#1}{#2}{\outB}{#3}}
\ExplSyntaxOff

\newcommand{\lub}{\ifthenelse{\boolean{mmode}}{\sqcap}{\raisebox{.1em}{\ensuremath{\sqcap}}}\xspace}
\newcommand{\sqlt}{\ensuremath{\sqsubset}\xspace}
\newcommand{\sqlte}{\ensuremath{\sqsubseteq}\xspace}

%% End dataflow

%% MIL Chapter
\newcommand{\compMILE}[1]{\ensuremath{\left\llbracket #1 \right\rrbracket}}
\newcommand{\compMILV}[1]{\ensuremath{\left\llbracket #1 \right\rrbracket}}
\newcommand{\compMILQ}[2]{\ensuremath{\left\llbracket #2 \right\rrbracket}}
\newcommand{\milCtx}[1]{\ensuremath{\llfloor}#1\ensuremath{\rrfloor}}
%% End MIL chapter

\newenvironment{myfig}[1][tbh]{\begin{figure}[#1]%%
\centering%%
\figbegin}{\figend%%
\end{figure}}

%% Produce a sub-caption and label it.
\newcommand{\scap}[2][1in]{\begin{minipage}{#1}%%
\subcaption{}\label{#2}\end{minipage}}

%% Produce a sub-caption with text.
\newcommand{\lscap}[3][1in]{\begin{minipage}{#1}%%
\subcaption{#3}\label{#2}\end{minipage}}

% single-argument comment. Do not put
% a space before the command when used
% or the file will have two spaces.
\newcommand{\rem}[1]{}

%% A verbatim environment with active charactesr
%% so we can use math shortcuts and macros
\DefineVerbatimEnvironment{AVerb}{Verbatim}{commandchars=\\\{\},%% 
  codes={\catcode`\_8\catcode`\$3\catcode`\^7},%%
  numberblanklines=false}

%% Turn on line numbers for Haskell code, 
%% and reset the line number counter.
\newcommand{\hsNumOn}{\numberson\numbersreset}
\newcommand{\hsNumOff}{\numbersoff}
%% Turn on line numbering in Haskell code within
%% the environment, then turn it off.
\newenvironment{withHsNum}{\numberson\numbersreset}{\numbersoff}

%% Paragraph run-in
\newcommand{\runin}[1]{\begingroup\noindent\sffamily\textbf{#1}\qquad\endgroup}

%% Chapter bibliographies
\newcommand{\standaloneBib}{%%
  \ifthenelse{\boolean{standaloneFlag}}%%
             {\begin{singlespace}
                \printbibliography
             \end{singlespace}}{}}

%% Adds an equation number on demand.
\newcommand\addtag{\refstepcounter{equation}\tag{\theequation}}

%% For typesetting set definitions like {x | x \in f(y)}
\newcommand\setdef[2]{\ensuremath{\{#1\ |\ #2\}}}

%% For typesetting function names like dom(f) or out(b).
\newcommand\mfun[1]{\ensuremath{\mathit{#1}}}

%% Marginal notes
\newcommand\margin[2]{\marginpar{\begin{singlespace}\emph{\footnotesize #2}\end{singlespace}}\relax #1}

%% Describe intent of a passage
\newcommand\intent[1]{{\leftskip = -1in\begin{singlespace}\emph{\noindent\footnotesize Intent: #1}\end{singlespace}}}
