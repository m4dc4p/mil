%&PDFLATEX
\makeatletter\@ifclassloaded{report}{}
  {\documentclass[12pt]{report}
    \usepackage{standalone}
    \input{tikz.preamble}
    %% Indicates the preamble declared the 
    %% documentclass
    \def\preambledocclass{}}

\usepackage[T1]{fontenc}
%% Footnotes with old style caps hard to read - this helps.
\renewcommand\@makefnmark{\mbox{\textsuperscript{%
      \normalfont\ensuremath{\@thefnmark}}}}

\usepackage{calc}
\usepackage[osf,sc]{mathpazo}
\renewcommand\ttdefault{lmtt}
\usepackage{helvet}
\usepackage{xspace}
\usepackage{url}
\usepackage{fancyvrb}
\usepackage[doublespacing]{setspace}
%% below only necessary when using doublespacing -- corrects
%% the vertical space inserted when switching to singlespace
%% environment.
\def\correctspaceskip{\vskip-\baselineskip} 
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage[margin=\parindent, format=hang,labelfont=bf]{caption}
%% \usepackage[subrefformat=parens]{subcaption}
%% The following makes sure we get parentheses around
%% subreferences. The newest version of the subcaption
%% package has an option for this, but that's not available
%% widely.
%%
%% From http://tex.stackexchange.com/questions/25644
\usepackage[labelformat=simple]{subcaption}
\def\thesubfigure{(\alph{subfigure})}
\providecommand\thefigsubsep{~}
\def\p@subfigure{\@nameuse{thefigure}\thefigsubsep}

\usepackage{ifthen}
\usepackage{stmaryrd}
\usepackage{longtable}
\usepackage{afterpage}
\usepackage{xifthen}
\usepackage{mathtools}
\usepackage[natbib=true,style=authoryear,backend=bibtex8]{biblatex}
\setlength{\bibitemsep}{\bigskipamount}
\addbibresource{thesis.bib}
\usepackage{microtype}

%% GSO margins.
\usepackage[left=1.5in, right=1in, top=1in, bottom=1in,includeheadfoot]{geometry}
\usepackage{array}
\usepackage{abstract}

%% GSO requires 12 pt font for all chapter headings
\usepackage[bf,sf,tiny,compact]{titlesec}
\titleformat{\chapter}[display]
            {}% format
            {\sffamily\bfseries\chaptertitlename\ \thechapter}
            {\baselineskip}
            {\sffamily\bfseries}
            {}
%% Reduce vertical space above chapter headings on chapter
%% pages.
\titlespacing*{\chapter}{0pt}{0pt}{2\bigskipamount}

%% GSO TOC requirements.
\usepackage{tocloft}
%% Make room to set ``Chapter N  '' 
\setlength\cftchapnumwidth{\widthof{Chapter\ \ 9\quad}}
%% Chapter entries in TOC need to include ``Chapter''
\renewcommand\cftchappresnum{Chapter\ \ }
\renewcommand\cftchapaftersnum{\quad}
%% Make ``Contents'' and ``List of Figures'' 12 pt Sans Serif
\renewcommand\cfttoctitlefont{\sffamily\bfseries\normalsize}
\renewcommand\cftloftitlefont{\sffamily\bfseries\normalsize}
%% Reduce vertical space above ``Contents'' and ``List of Figures''
\setlength\cftbeforetoctitleskip{0pt}
\setlength\cftbeforeloftitleskip{0pt}
%% Ensure entries in LOF are on the left margin.
\setlength\cftfigindent{0pt}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small\textsc{\chaptertitlename\ \thechapter}}
\fancyhead[R]{\small\leftmark}
\fancyfoot[C]{\small\thepage}
\headheight=15pt
\fancypagestyle{plain}{%
  \fancyhf{} % clear all header and footer fields
  \fancyfoot[C]{\small\thepage}}
\renewcommand\headrulewidth{0pt}
\renewcommand\chaptermark[1]{\markboth{#1}{}}
\hyphenation{data-flow mo-na-dic} 

%% Should unindent all haskell code set in a display (versus inline)
\@ifundefined{hscodestyle}{}
  {\renewcommand{\hscodestyle}{\advance\leftskip -\mathindent}}

%% Recommended stretch for CM 10pt roman.
\emergencystretch=3em

% Used by included files to know they
% are NOT standalone
\newboolean{standaloneFlag}
\setboolean{standaloneFlag}{true}

\newlength{\rulefigmargin}
\setlength{\rulefigmargin}{2\parindent}

\newcommand\figbegin{\rule{\linewidth}{0.4pt}\\\vspace{12pt}}
\newcommand\figend{\rule{\linewidth}{0.4pt}}

%% Sets
\newcommand{\setL}[1]{\textsc{#1}\xspace}
\newcommand{\setLC}{\setL{Const}}

%% Lub, subset operators.
\protected\def\lub{\ensuremath{\sqcap}\xspace}
\newcommand{\sqlt}{\ensuremath{\sqsubset}\xspace}
\newcommand{\sqlte}{\ensuremath{\sqsubseteq}\xspace}

%% Subscripting with typewriter
\def\subtt#1{\ifmmode_{\ensurett{#1}}%%
  \else$_{\ensurett{#1}}$%%
  \fi}
%% Superscripting with typerwriter
\def\suptt#1{\ifmmode^{\ensurett{#1}}%%
  \else$^{\ensurett{#1}}$%%
  \fi}
%% Functional languages chapter commands
\newcommand{\lamA}{\ensuremath{\lambda}-calculus\xspace}
\newcommand{\LamA}{\ensuremath{\lambda}-Calculus\xspace}
\newcommand{\lamAbs}[2]{\ensuremath{\lambda#1.\ #2}}
\newcommand{\lamApp}[2]{\ensuremath{#1\ #2}}
\newcommand{\lamPApp}[2]{\ensuremath{(#1\ #2)}}
\newcommand{\lamAPp}[2]{\ensuremath{(#1)\ #2}}
\newcommand{\lamApP}[2]{\ensuremath{#1\ (#2)}}
\newcommand{\lamAPP}[2]{\ensuremath{(#1)\ (#2)}}
\let\lamApPp=\lamApP
\let\lamAppP=\lamAPp
%% LC definition
\newtoks\toksA
\protected\def\lcname#1/{\ensuremath{\mathit{\removespaces #1}}}
\protected\def\lcdef#1(#2)=#3;{\def\arg{#2}%%
  \def\lcargs##1,##2/{\def\arg{##2}%%
    \ifx\empty\arg%%
    \lcname ##1/%%
    \else\lcname ##1/\ \lcargs ##2/%%
    \fi}%%
  \ifx\empty\arg\toksA={\ }%%
  \else\toksA={\ \lcargs #2,/\ }%%
  \fi%%
  \ensuremath{\lcname#1/\the\toksA =\ #3}}
%% Arbitrary number of applied arguments, separated
%% by asterisks (*).
\protected\def\lcapp#1/{\def\lcappB##1*##2/{\def\arg{##2}%
    \ensuremath{\ifx\arg\empty%%
      ##1%%
      \else%%
      ##1\ \lcappB##2/%%
      \fi}}%%
  %% Adding a star here makes
  %% sure our application always ends with an asterisks, ensuring
  %% #2 will be \empty at some point.
  \lcappB#1*/}
\protected\def\lcabs#1.{\ensuremath{\lambda\relax #1.\ }}
%% LC primitve function.
\protected\def\lcprim#1*{\ensuremath{#1^*}}
%% LC constructor
\protected\def\lccons#1(#2){\ensuremath{\mfun{#1}\ \ignorespaces #2}}

\newcommand{\lamId}{\lamAbs{x}{x}}
\newcommand{\lamCompose}{\lamAbs{f}{\lamAbs{g}{\lamAbs{x}{\lamApp{f}{(\lamApp{g}{x})}}}}}
\newcommand{\machLam}{\ensuremath{M_\lambda}\xspace}
\newcommand{\compMach}[1]{\ensuremath{\left\llbracket #1 \right\rrbracket}}
\newcommand{\compRho}[1]{\ensuremath{\rho(#1)}}
\newcommand{\verSub}[2]{\ensuremath{#1_{#2}}}
\newcommand{\verSup}[2]{\ensuremath{#1^{#2}}}
\newcommand{\lamC}{\ensuremath{\lambda_C}\xspace}
\newcommand{\lamPlus}{\lamAbs{m}{\lamAbs{n}{\lamAbs{s}{\lamAbs{z}{\lamApp{m}{\lamApPp{s}{\lamApp{n}{\lamApp{s}{z}}}}}}}}}
%% Substitution notation -- [#1 -> #2]
\newcommand{\lamSubst}[2]{\ensuremath{[#1 \mapsto #2]}}
%% End functional languages chapter


%% MIL Chapter
\newcommand{\compMILE}[1]{\ensuremath{\left\llbracket #1 \right\rrbracket}}
\newcommand{\compMILV}[1]{\ensuremath{\left\llbracket #1 \right\rrbracket}}
\newcommand{\compMILQ}[2]{\ensuremath{\left\llbracket #2 \right\rrbracket}}
\newcommand{\milCtx}[1]{\ensuremath{\llfloor}#1\ensuremath{\rrfloor}}

%% This dimension makes sure the same amount of space
%% follows | and := in syntax rules like:
%%
%% term := var       (Variable)
%%      |  var var    (Application)
%%      |  \x. var    (Abstraction)
%%
\newdimen\termalign
\setbox0=\hbox{$:=$}
\termalign=\wd0 
\protected\def\term#1/{\ensuremath{\mathit{#1}}}
\protected\def\syntaxrule#1/{\hfil\text{\emph{#1}}}
\protected\long\def\termrule#1:#2:#3/{\term #1/ &\hbox{$:=$}\ensuremath{\ #2} & \syntaxrule #3/}
\protected\def\termcase#1:#2/{&\hbox to \termalign{$|$\hss}\ensuremath{\ #1} & \syntaxrule #2/}

%% Produce a ``meaning'' equation
%% where
%%  
%%  [| #1 |] => <following group>
%%
%% LCToMIL should have one argument and be followed by a group. The group
%% should be translation of the expression.
\newtoks\meaningtoks \newbox\meaningbox
\protect\def\LCToMIL#1{%%
  \gdef\LCToMILa{\meaningtoks={\setbox\meaningbox=\vbox\bgroup\aftergroup\LCToMILb}
    \the\meaningtoks}%%
  \gdef\LCToMILb{\vtop{\compMILE{#1}} = \ensuremath{\vtop{\hbox{\box\meaningbox}}}}%%
    \afterassignment\LCToMILa\let\next= }

%% A "strut" the height of a parantheses; \strut
%% produces a bar that is too tall in double-spaced
%% paragraphs at time.
\def\parstrut{\vphantom{(}}
%% Typeset the ``do'' keyword
\def\hsdo{\ensuremath{\mathbf{do\;}}}
\def\hslet{\ensuremath{\mathbf{let\;}}}
\def\hsreturn{\ensuremath{\mathbf{return\;}}}
%% End MIL chapter

%% Dataflow Chapter
% Domain function
\def\dom(#1){\ensuremath{\mfun{dom}(#1)}\xspace}
% Set of all integers.
\def\ZZ{\ensuremath{\mathbb{Z}}}
%%

%% Uncurrrying Chapter 
%% A space equal to a \thinspace, but we
%% can break a line at it.
\newskip\thinskipamt \thinskipamt=.16667em 
\protected\def\thinskip{\hskip \thinskipamt\relax}
\protected\def\thinnerskip{\hskip .5\thinskipamt\relax}
%% Capture a space token. Use a ``control-symbol'' (\. instead of \mksp)
%% to keep the trailing space from getting gobbled.
{\def\.{\global\let\sp= } \. }
%% Define \asp, which will capture the macro definition attached to space,
%% if one exists. Otherwise, \spa is relax after this.
{\catcode`\ =\active\gdef\asp{\ifx \relax\let\spa\relax\else\let\spa= \fi}}
\newtoks\foo
%% Removes spaces, implicit, active and explicit.
\protected\def\removespaces{\asp\afterassignment\removesp\let\next= }
\def\removesp{\foo={\next}\ifcat\noexpand\next\sp\foo={\removespaces}%%
 \else\ifx\next\spa\foo={\removespaces}\fi%%
 \fi\the\foo}
%% MIL reserved word
\protected\def\milres#1/{\text{\ttfamily\bfseries #1}}
\protected\def\lab#1/{\textbf{\ensurett{\removespaces #1}}}
%% Constructs a closure: l { v1, ..., vN }
\protected\long\def\mkclo[#1:#2]{\lab #1/\ensuremath{\,\{\ensurett{#2}\}}\xspace}
%% Tuple version of closurs: {l: v1, ..., vN}.
\protected\long\def\clo[#1:#2]{\def\argA{#1}\def\argB{#2}\ensuremath{\{%%
      \ifx\argA\empty%%
      \else\lab #1/%%
        \ifx\argB\empty%%
        \else\ensurett{:\thinskip}%%
        \fi%%
      \fi\ensurett{#2}\}}\xspace}
%% Construct a thunk
\newbox\bracklbox \newbox\brackrbox
\setbox0=\hbox{$\{$} \setbox\bracklbox=\hbox to \wd0{\hfil[\kern0.25mm}
\setbox0=\hbox{$\}$} \setbox\brackrbox=\hbox to \wd0{\kern0.25mm]\hfil}
\protected\def\mkthunk[#1:#2]{\lab #1/%%
  \ensuremath{\,%%
    \mathopen{\copy\bracklbox}%%
    \ensurett{#2}%%
    \mathclose{\copy\brackrbox}\xspace}}
%% Binding statement: v <- {...}
\protected\def\binds#1<-#2;{\ensuremath{\ensurett{\removespaces #1\ \texttt{<-}\ \removespaces #2}\xspace}}
%% In order to use \binds in verbatim environment, have to define
%% delimiters while they are active. The below defines \vbinds which
%% must be used in AVerb environments.  Notice the active space as
%% well - that is necessary so the space after \vbinds (and before the
%% first argument) in the verbatim environment gets eaten.
\begingroup\catcode`\!=\active \lccode`\!=`\< \lccode`\~=`\- 
  \catcode`\ =\active\lowercase{\endgroup\def\vbinds#1!~#2;}{\binds#1<-#2;}
\begingroup\catcode`\!=\active \lccode`\!=`\> \lccode`\~=`\- 
  \catcode`\ =\active\lowercase{\endgroup\def\valt#1(#2)#3~!#4;}{\alt#1(#2)#3->#4;}
%% Return statement: return ... ;
\protected\def\return#1/{\milres return/\ensurett{\ \removespaces #1}}
%% A closure capturing block. k {v1, ..., vN} x: ...
\protected\def\ccblock#1(#2)#3:{\lab#1/\ensuremath{\thinspace\{\ensurett{#2}\}}\ \ensurett{#3\hbox{:}}}
%% A normal block
\protected\def\block#1(#2):{\lab #1/\ensuremath{\thinspace(\ensurett{#2})}\ensurett{:}}
%% A goto expression
\protected\def\goto#1(#2){\lab #1/\thinspace\ensuremath{(\ensurett{#2})}}
%% An enter expression
\protected\def\app#1*#2/{\ensurett{\removespaces #1\ifmmode\ \fi{\text{\tt @}}\ifmmode\ \fi#2}}
\protected\def\mbind{\texttt{<-}\xspace}
%% Primitive expression
\protected\def\prim#1(#2){\lab #1/\suptt*\ensuremath{(\ensurett{#2})}}
%% Program variable
\protected\def\var#1/{\ensuremath{\ensurett{\removespaces #1}\xspace}}
%% Case statement
\protected\def\case#1;{\milres case\ \ensuremath{\ensurett{\removespaces #1}}\ of/}
%% Case alternative
% \protected\def\alt#1(#2)#3->#4;{\ensuremath{\ensurett{\ignorespaces #1\ \ignorespaces#2\ \texttt{->}\ \ignorespaces #4}}}
% \ifx\arg\empty\else\ignorespaces#2\ \fi
\protected\def\alt#1(#2)#3->#4;{\def\altarg{#2}%%
  \ensuremath{\ensurett{%%
      \ignorespaces #1\ \ifx\altarg\empty\else\ignorespaces#2\ \fi\texttt{->}\ \ignorespaces #4}}}
%% Invoke
\protected\def\invoke#1/{\edef\arg{#1}%%
  \milres invoke/\ifx\arg\empty%%
  \else\ensurett{\ \removespaces #1}\fi}
\def\rhs{right-hand side\xspace}
\def\lhs{left-hand side\xspace}
\def\enter{\texttt{@}\xspace}
\def\cc{closure-capturing\xspace}
\def\Cc{Closure-capturing\xspace}
%%

\newenvironment{myfig}[1][tbh]{\begin{figure}[#1]%%
\begin{singlespace}\centering%%
\figbegin}{\figend\end{singlespace}%%
\end{figure}}

%% Produce a sub-caption and label it.
\newcommand{\scap}[2][1in]{\begin{minipage}{#1}%%
\subcaption{}\label{#2}\end{minipage}}

%% Produce a sub-caption with text.
\newcommand{\lscap}[3][\hsize]{\begin{minipage}{#1}%%
\subcaption{#3}\label{#2}\end{minipage}}

% single-argument comment. Do not put
% a space before the command when used
% or the file will have two spaces.
\newcommand{\rem}[1]{}

%% A verbatim environment with active charactesr
%% so we can use math shortcuts and macros
\DefineVerbatimEnvironment{AVerb}{Verbatim}{commandchars=\\\{\},%% 
  codes={\catcode`\_8\catcode`\$3\catcode`\^7},%%
  numberblanklines=false}

\DefineVerbatimEnvironment{Verb}{Verbatim}{commandchars=\\\[\],%% 
  numberblanklines=false}

%% Turn on line numbers for Haskell code, 
%% and reset the line number counter.
\newcommand{\hsNumOn}{\numberson\numbersreset}
\newcommand{\hsNumOff}{\numbersoff}
%% Turn on line numbering in Haskell code within
%% the environment, then turn it off. The optional
%% argument specifies a prefix that \hslabel can
%% use to generate line number references. If no prefix
%% is givne, \hslabel will have no effect.
\newtoks\prefixtoks \newif\ifprefix
\def\mkhslabel#1{\prefixtoks={#1}\prefixtrue}
\def\hslabel#1{\ifprefix\label{\the\prefixtoks_#1}\fi}
\def\unhslabel{\prefixfalse}
\newenvironment{withHsNum}{\numberson\numbersreset}{\numbersoff}
\newenvironment{withHsLabeled}[1]{\numberson\numbersreset\mkhslabel{#1}}{\unhslabel\numbersoff}

%% Paragraph run-in
\newcommand{\runin}[1]{\begingroup\noindent\sffamily\textbf{#1}\qquad\endgroup}

%% Chapter bibliographies
\newcommand{\standaloneBib}{%%
  \ifthenelse{\boolean{standaloneFlag}}%%
             {\begin{singlespace}
                 \printbibliography
             \end{singlespace}}{}}

%% Adds an equation number on demand.
\newcommand\addtag{\refstepcounter{equation}\tag{\theequation}}

%% For typesetting set definitions like {x | x \in f(y)}
\newcommand\setdef[2]{\ensuremath{\{#1\ |\ #2\}}}

%% For typesetting function names like dom(f) or out(b).
\newcommand\mfun[1]{\ensuremath{\mathit{#1}}}

%% Marginal notes
\newcommand\margin[2]{\marginpar{\begin{singlespace}\emph{\footnotesize #2}\end{singlespace}}\relax #1}

%% Describe intent of a passage
\newcommand\intent[1]{{\begin{singlespace}\noindent\leftskip=-1in\emph{\footnotesize Intent: #1}\end{singlespace}}\nopagebreak[1]}
\renewcommand\intent[1]{}

%% In aligned/alignedat/gathered environments, you don't et
%% automatic equation numbers. This command makes sure to
%% label them properly.
\newcommand\labeleq[1]{\refstepcounter{equation}\label{#1}}

%% Labels an equation in an aligned environment.
\newcommand\labeledeq[1]{\labeleq{#1}\eqref{#1}}

%% Creates a hanging paragraph, where the first line is not
%% indented but all other lines are.
\def\itempar#1{\noindent\hangindent=\parindent\hangafter=1 #1\quad}

%% Disable overfull messages with ridiculous hfuzz value
\def\disableoverfull{\hfuzz=10in}

%% Set parfillskip so stretching does NOT occur at the end of
%% a paragraph (i.e., list of elements). Disable indent at beginning
%% of paragraph. Also turn off underfull hbox warnings.
%%
%% Intended to be used in a \vbox that forms part of a table or graphic,
%% which we want to be line-broken but not exactly like a normal paragraph.
\long\def\disableparspacing#1;{\def\arg{#1}\hbadness=100000\parindent=0pt\parfillskip=0pt\leftskip=0pt\rightskip=0pt%%
  \ifx\arg\empty\else\hsize=#1\relax\fi}
\include{md}
\domd

%% Place an input file on the next page
\def\onnextpage#1{\afterpage{\clearpage\input{#1}\clearpage}}

%% C-- (C minus minus)
\def\Cmm{C\texttt{-{}-}\xspace}

%% Abbreviations
\def\mil{\textsc{mil}\xspace}
\def\Mil{\textsc{Mil}\xspace}
\def\cfg{\textsc{cfg}\xspace}
\def\cfgs{\textsc{cfg}s\xspace}
\def\hoopl{\textsc{hoopl}\xspace}
\def\Hoopl{\textsc{Hoopl}\xspace}
\def\ast{\textsc{ast}\xspace}

%% Indicates the preamble has been loadd.
\def\preambleloaded{}

%% All of lhs2tex's included definitions.
\input{lhs2tex}
\makeatother
