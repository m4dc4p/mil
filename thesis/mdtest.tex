\documentclass{article}
\usepackage{fancyvrb}
\DefineVerbatimEnvironment{AVerb}{Verbatim}{commandchars=\\\{\},%% 
  codes={\catcode`\_8\catcode`\$3\catcode`\^7},%%
  numberblanklines=false}
\usepackage{tikz}
\usetikzlibrary{arrows,automata,positioning,calc}
\include{md}
\begin{document}
%% \tracingmacros=1\tracingcommands=2
\obeylines
!+hello1.+!
!+hello2.+!
+hello4!
foo!+\emph{}+!bar
foo!\emph{bar}!
\emph{!+hello5+! yay}
!+hello6!+hello7+!
!+hello7+++\ ! +\ !++!
foo!+\emph{bar}+!
%% \tracingmacros=0\tracingcommands=0
\begin{figure}
Hello Figure!
\caption{!+foo.+!}
\end{figure}
$(\mathtt{v_m\ \texttt{<-}\ k\ b\ \{v_1, \dots, v_n\}}, F)$
\ensuremath{(\mathtt{v_m\ \texttt{<-}\ k\ b\ \{v_1, \dots, v_n\}}, F)}
\texttt{$(\mathtt{v_m} $<-$ \mathtt{k\ b\ \{v_1, \dots, v_n\}}, F)$}
\clearpage
\domd
!+hello1.+!
!+hello2.+!
+hello4!
foo!+\emph{}+!bar
foo!\emph{bar}!
\emph{!+hello5+! yay}
!+hello6!+hello7+!
!+hello7+++\ ! +\ !++!
foo!+\emph{bar}+!
%% \tracingmacros=0\tracingcommands=0
\begin{figure}
Hello Figure!
\caption{!+foo.+!}
\end{figure}
\begin{figure}
\begin{minipage}{\hsize}
\begin{tikzpicture}[>=stealth, node distance=.75in]
\withmd{
  \node[] (entry) {};
  \node[below=0.2in of entry] (assign) {\begin{minipage}{0.5in}
      \begin{AVerb} 
m = 10
n = 1
i = 0
      \end{AVerb}
    \end{minipage}};

  \node[below=of assign] (test) {!+i < cnt+!};
  \node[right=of test] (mult) {!+n += val * m+!};
  \node[below=of mult] (incr) {!+i+++!};
  \node[below=of test] (return) {!+return n+!};
  \node[below=0.2in of return] (exit) {};

  \draw [->>] (entry) to (assign);
  \draw [->] (assign) to (test);
  \draw [->] (test) to (mult);
  \draw [->] (mult) to (incr);
  \pausemd{\draw [->] (incr) -| ($(mult.east) + (5mm,0mm)$) |- ($(test.north)!.5!(assign.south)$) to (test.north);}
  \draw [->] (test) to (return);
  \draw [->>] (return) to (exit);
}
\end{tikzpicture}
\end{minipage}
\end{figure}
$(!+v_m\ \texttt{<-}\ k\ b\ \{v_1, \dots, v_n\}+!, F)$
\ensuremath{(\mathtt{v_m\ \texttt{<-}\ k\ b\ \{v_1, \dots, v_n\}}, F)}
\texttt{$(\mathtt{v_m} $<-$ \mathtt{k\ b\ \{v_1, \dots, v_n\}}, F)$}

\end{document}
